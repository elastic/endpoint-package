---
- name: api
  title: API
  group: 2
  short: Fields describing an API call.
  type: object
  description: >
    These fields describe an API call (function, or system call).

  reusable:
    top_level: true
    expected:
      - process.Ext

  fields:
    - name: name
      level: custom
      type: keyword
      description: >
        The name of the API, usually the name of the function or system call.
      example: "VirtualAlloc"

    - name: summary
      level: custom
      type: keyword
      description: >
        The summary of the API call and its parameters.
      example: "VirtualAllocEx( file.exe, NULL, 0x42000, COMMIT|RESERVE, RWX )"

    - name: behaviors
      level: custom
      type: keyword
      short: A list of observed behaviors.
      description: |
        A list of observed behaviors.
          "cross-process" - the observed activity was between two processes
          "parent-child" - the observed activity was between a parent process and its child
          "native_api" - a call was made directly to the Native API rather than the Win32 API
          "direct_syscall" - a syscall instruction originated outside of the Native API layer
          "proxy_call" - the call stack may indicate of a proxied API call to mask the true source
          "sensitive_api" - executable non-image memory is unexpectedly calling a sensitive API
          "shellcode" - suspicious executable non-image memory is calling a sensitive API
          "image_hooked" - an entry in the callstack appears to have been hooked
          "image_indirect_call" - an entry in the callstack was preceded by a call to a dynamically resolved function
          "image_rop" - no call instruction preceded an entry in the call stack
          "image_rwx" - an entry in the callstack is writable
          "unbacked_rwx" - an entry in the callstack is non-image and writable
          "allocate_shellcode" - a region of non-image executable memory allocated more executable memory
          "execute_fluctuation" - the PAGE_EXECUTE protection is unexpectedly fluctuating
          'write_fluctuation" - the PAGE_WRITE protection of executable memory is unexpectedly fluctuating
          "hook_api" - a change to the memory protection of a small executable image memory region was made
          "hollow_image" - a change to the memory protection of a large executable image memory region was made
          "hook_unbacked" - a change to the memory protection of a small executable non-image memory was made
          'hollow_unbacked" - a change to the memory protection of a large executable non-image memory was made
          "guarded_code" - executable memory was unexpectedly marked as PAGE_GUARD
          "hidden_code" - executable memory was unexpectedly marked as PAGE_NOACCESS
          "execute_shellcode" - a region of non-image executable memory was unexpectedly transferred control
          "hardware_breakpoint_set" - a hardware breakpoint was set
      example: [ "cross-process", "native_api", "shellcode" ]

    - name: metadata
      level: custom
      type: object
      description: >
        Information related to the API call.

    - name: metadata.target_address_name
      level: custom
      type: keyword
      description: >
        The name of the memory region targeted by the API call.
      example: "Unbacked"

    - name: metadata.target_address_path
      level: custom
      type: keyword
      description: >
        The path of the memory region targeted by the API call.
      example: "C:\\programdata\\example.dll"
