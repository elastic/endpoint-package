{
    "@timestamp": "2023-01-09T19:38:51.5141503Z",
    "Target": {
        "process": {
            "Ext": {
                "memory_region": {
                    "allocation_base": 1649160290304,
                    "allocation_protection": "RWX",
                    "allocation_size": 4096,
                    "allocation_type": "PRIVATE",
                    "bytes_address": 1649160290304,
                    "bytes_allocation_offset": 0,
                    "bytes_compressed": "eJztwbEJACAMALA+5uAtWnAoOPg/+EWnJO9k1bo742XuMRsEAAAA0OsD8lge9g==",
                    "bytes_compressed_present": true,
                    "hash": {
                        "sha256": "0b28b598ef70fd2377613fd88a50d52047ae31c16f2c688f3aa4e0b98d63730c"
                    },
                    "memory_pe_detected": false,
                    "region_base": 1649160290304,
                    "region_protection": "R--",
                    "region_size": 4096,
                    "region_state": "COMMIT",
                    "strings": [
                        "shellcode",
                        "seed=AAAA"
                    ]
                },
                "token": {
                    "integrity_level_name": "high"
                }
            },
            "entity_id": "YWFhYWFhYWEtYWFhYS1hYWFhLWFhYWEtYWFhYWFhYWFhYWFhLTI1NzMyLTE2OTkwMDE3NDAuOTU4NTY4MDAw",
            "executable": "C:\\Temp\\1_StayRunningWin32_x64.exe",
            "name": "1_StayRunningWin32_x64.exe",
            "pid": 25732
        }
    },
    "event": {
        "category": [
            "api",
            "intrusion_detection"
        ],
        "created": "2023-01-09T19:38:51.5141503Z",
        "dataset": "endpoint.events.api",
        "id": "MvlgiHxIZtj1+Abi++++++ul",
        "kind": "event",
        "module": "endpoint",
        "outcome": "success",
        "provider": "Microsoft-Windows-Threat-Intelligence",
        "sequence": 3802,
        "type": [
            "credential_access"
        ]
    },
    "host": {
        "architecture": "x86_64",
        "hostname": "DESKTOP-OCG8CR6",
        "id": "dabadaba-0000-0000-0000-000000000000",
        "ip": [
            "169.254.104.226",
            "fe80::6037:d589:2ee9:772f",
            "172.22.6.230",
            "fe80::80ea:8e8d:e1f2:6622",
            "169.254.74.35",
            "fe80::900c:a9d3:fd8:9345",
            "127.0.0.1",
            "::1"
        ],
        "mac": [
            "00-15-5D-00-09-18",
            "00-15-5D-00-09-19",
            "00-15-5D-00-09-17"
        ],
        "name": "DESKTOP-OCG8CR6",
        "os": {
            "Ext": {
                "variant": "Windows 11 Enterprise N"
            },
            "family": "windows",
            "full": "Windows 11 Enterprise N 22H2 (10.0.22621.963)",
            "kernel": "22H2 (10.0.22621.963)",
            "name": "Windows",
            "platform": "windows",
            "type": "windows",
            "version": "22H2 (10.0.22621.963)"
        }
    },
    "message": "Endpoint API event - hand-crafted with a superset of fields",
    "process": {
        "Ext": {
            "ancestry": [
                "YWFhYWFhYWEtYWFhYS1hYWFhLWFhYWEtYWFhYWFhYWFhYWFhLTgxMi0xNjczMjkxNTMzLjcxNjczMTgwMA==",
                "YWFhYWFhYWEtYWFhYS1hYWFhLWFhYWEtYWFhYWFhYWFhYWFhLTQ5NjAtMTY3Mjk2NTgzMC4yODc0OTYxMDA=",
                "YWFhYWFhYWEtYWFhYS1hYWFhLWFhYWEtYWFhYWFhYWFhYWFhLTY2MjgtMTY3Mjk2NTc3Mi41MTg4MDA1MDA=",
                "YWFhYWFhYWEtYWFhYS1hYWFhLWFhYWEtYWFhYWFhYWFhYWFhLTQ2MDAtMTY3Mjk2NTcxMy40NzY1NDUyMDA="
            ],
            "api": {
                "behaviors": [
                    "cross-process",
                    "rapid_background_polling",
                    "multiple_polling_processes"
                ],
                "metadata": {
                    "target_address_name": "Unbacked",
                    "target_address_path": "c:\\windows\\system32\\ntdll.dll",
                    "return_value": 1,
                    "windows_count": 2,
                    "visible_windows_count": 0,
                    "thread_info_flags": 16,
                    "module_name": "C:\\Windows\\System32\\DellTPad\\ApMsgFwd.exe",
                    "allocation_protection": "RCX",
                    "procedure_symbol": "taskbar.dll",
                    "ms_since_last_keyevent": 94,
                    "background_callcount": 6021
                },
                "name": "OpenProcess",
                "parameters": {
                    "desired_access": [
                        "PROCESS_QUERY_LIMITED_INFORMATION",
                        "PROCESS_VM_READ"
                    ],
                    "desired_access_numeric": 4112,
                    "handle_type": "process",
                    "address": 2904525045760,
                    "allocation_type": "COMMIT|RESERVE",
                    "protection": "R-X",
                    "protection_old": "R-X",
                    "size": 16,
                    "context_flags": 1048607,
                    "r8": 8,
                    "r9": 9,
                    "rax": 10,
                    "rbp": 3,
                    "rbx": 11,
                    "rcx": 2883351609344,
                    "rdi": 5,
                    "rdx": 13,
                    "rip": 140706538588528,
                    "rsi": 4,
                    "rsp": 2,
                    "eax": 10,
                    "ebp": 3,
                    "ebx": 11,
                    "ecx": 12,
                    "edi": 5,
                    "edx": 0,
                    "eip": 1,
                    "esi": 4,
                    "esp": 2,
                    "argument1": 2583984274656,
                    "argument2": 4105953215,
                    "argument3": 31058890,
                    "procedure": 140705553857280,
                    "usage_page": "GENERIC",
                    "usage": "KEYBOARD",
                    "flags": "INPUTSINK",
                    "hook_type": "WH_KEYBOARD_LL",
                    "hook_module": "c:\\windows\\system32\\taskbar.dll"
                },
                "summary": "VirtualAllocEx( charmap.exe, NULL, 0x10, COMMIT|RESERVE, R-X )"
            },
            "code_signature": [
                {
                    "exists": true,
                    "status": "errorBadDigest",
                    "subject_name": "Microsoft Windows",
                    "trusted": false
                }
            ],
            "memory_region": {
                "allocation_base": 140712018378752,
                "allocation_protection": "RCX",
                "allocation_size": 45056,
                "allocation_type": "IMAGE",
                "mapped_path": "C:\\Program Files\\Python39\\DLLs\\libffi-7.dll",
                "region_base": 140712018395136,
                "region_protection": "R-X",
                "region_size": 8192,
                "region_state": "COMMIT"
            },
            "token": {
                "integrity_level_name": "system"
            }
        },
        "code_signature": {
            "exists": true,
            "status": "errorBadDigest",
            "subject_name": "Microsoft Windows",
            "trusted": false
        },
        "command_line": "",
        "entity_id": "YWFhYWFhYWEtYWFhYS1hYWFhLWFhYWEtYWFhYWFhYWFhYWFhLTkxNi0xNjczMjkzMTMwLjk0NjAwMjAw",
        "executable": "c\\git\\endpoint-dev\\Tools\\Leia\\modules\\exe_malware\\mimikatz.exe",
        "name": "mimikatz.exe",
        "pid": 916,
        "thread": {
            "Ext": {
                "call_stack": [
                    {
                        "allocation_private_bytes": 4096,
                        "protection_provenance": "dabapi.dll",
                        "symbol_info": "c:\\windows\\system32\\ntdll.dll!ZwProtectVirtualMemory+0x14"
                    },
                    {
                        "symbol_info": "c:\\windows\\system32\\kernelbase.dll!VirtualProtect+0x36"
                    },
                    {
                        "allocation_private_bytes": 8192,
                        "callsite_leading_bytes": "c048895424204c8bc9488d0d801f0000418d500248ff15052a00000f1f4400004883c438c3cccccccccccccccccccccc4883ec2048b880bf1acaf87f0000ffd0",
                        "callsite_trailing_bytes": "4883c420c3ec48498363e800498d4320ba2500000049c743e004000000440fb7ca4c8d05d0320000ba2b000000498943d848ff15f82a00000f1f4400004883c4",
                        "protection": "RWX",
                        "protection_provenance": "eventstests.exe",
                        "symbol_info": "c:\\windows\\system32\\dabapi.dll!DabApiBufferFree+0x10"
                    },
                    {
                        "symbol_info": "Unknown"
                    }
                ],
                "call_stack_final_user_module": {
                    "code_signature": [
                        {
                            "exists": true,
                            "status": "trusted",
                            "subject_name": "Microsoft Windows",
                            "trusted": true
                        }
                    ],
                    "hash": {
                        "sha256": "0386c57d59ee1292bb74d9878358da7a0ba00e5b56ed52fd6171b9e6d29d85aa"
                    },
                    "name": "dabapi.dll",
                    "path": "c:\\windows\\system32\\dabapi.dll",
                    "protection_provenance": "eventstests.exe"
                }
            },
            "id": 11628
        }
    },
    "user": {
        "domain": "DESKTOP-OCG8CR6",
        "id": "S-1-5-21-3820246941-898183108-3095036578-1001",
        "name": "User"
    }
}